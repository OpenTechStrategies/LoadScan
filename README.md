# LoadScan
LoadScan is a [Taurus](https://gettaurus.org/) script that generates load on different API endpoints, and measures the performance of these endpoints.

## Requirements
Get started by installing [Taurus](https://gettaurus.org/) and its dependencies.

    sudo apt-get update
    sudo apt-get install python3 default-jre-headless python3-tk python3-pip python3-dev \
    libxml2-dev libxslt-dev zlib1g-dev net-tools
    pip install --user bzt

The last command will install [JMeter](https://jmeter.apache.org/) and all other requirements.

## Run

1. `cp secrets.example.yml secrets.yml`
1. Edit `secrets.yml` to contain the needed configuration information
1. `cp accounts.example.csv accounts.csv`
1. Edit `accounts.csv` to contain valid login credentials for the application. *NOTE*: This is only required for workflows that use the `login-preexisting` scenario.
1. Set the scenario that you want to run in `run.yml`.
1. Point Taurus to `run.yml`

    ```
    bzt run.yml
    ```
The script writes artifacts to the `artifacts/` directory, and a `jmeter.log` in the root directory. To debug the running of a particuar scenario, open the JMeter gui when running the test.

    bzt -gui run.yml

## Project Structure

This project uses the following files and directories during execution:
- `actions.yml`: discrete API calls and blocks of functionality (e.g. login, upload a file)
- `scenarios.yml`: user stories, constructed from actions (e.g. A user logs in, uploads a file, and waits for the file to become viewable)
- `run.yml`: The top-level run file, which specifies the run duration, concurrency, user story/load test scenario to run, and reporting options
- `secrets.yml`: Sensitive required fields e.g. API keys
- `accounts.csv`: The login credentials for different user accounts
- `data/`: The directory where test data files are stored
- `files.csv`: The names of files to upload. This file is automatically generated during the "prepare" stage of execution from the files in `data/`

## Scenarios

Currently, the following workflows are available as scenarios for load testing.

- `login-preexisting-fileupload`: Login with user credentials specified in `accounts.csv` and upload files repeatedly, without polling for record status. This scenario is a convenient way to upload a large number of files to a small list of specified user accounts quickly.
- `login-fileupload-poll`: Create a new user account, login with that account, upload a file, and poll the record until processing has completed, then upload more files.
- `create-account-login`: Create an account, login, then logout. Repeat.

## Test Data

The provided test files in `data/` are all taken from the public domain. Sources: https://archive.org, https://pypi.org, and the author of this project (@xmunoz). You are not required to use these files. Simply set the path to the desired test files in `TEST_DATA_DIR` in `secrets.yml`. 
